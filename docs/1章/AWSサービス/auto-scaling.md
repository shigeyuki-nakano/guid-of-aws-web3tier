# Auto Scaling

## 概要
Amazon EC2 Auto Scaling は、アプリケーションの負荷を処理するために適切な数の Amazon EC2 インスタンスを利用できるようにします。<br>
Auto Scaling グループと呼ばれる EC2 インスタンスの集合を作成します。<br>
Auto Scaling グループ内でインスタンスの最小数・最大数を定義することができ、アプリケーションに対するリクエストの増減に応じて、最小数〜最大数の範囲でインスタンスの数が増減します。<br>
また、希望するキャパシティーを指定した場合、Amazon EC2 Auto Scaling によって、グループのインスタンス数はこの数に設定されます。

例えば、次の Auto Scaling グループで、インスタンス数の最小サイズが 1、希望するキャパシティが 2、最大サイズが 4 であるとします。<br>
この図の場合、最初は 2台 で起動しますが、スケーリングポリシーと負荷状況によって 1台 〜 4台 の間の台数で、柔軟に変化します。

<img src="./picture/ec2_autoscaling.png" width="500" alt="ウェブサイト環境構築手順ガイド">

## メリット
1. 耐障害性の向上。インスタンスの異常を検出し、インスタンスを削除して、その代わりに新しいインスタンスを起動することができます。
1. 複数のアベイラビリティーゾーン (AZ) を使用するように設定することもできます。たとえば、何かの障害により 1 つのアベイラビリティーゾーン (AZ) が利用できない場合は、別のアベイラビリティーゾーン (AZ) でインスタンスを起動します。
1. 可用性の向上。スケーリングポリシーにしたがって、トラフィックを処理するための適切な EC2 インスタンスの起動台数を調整します。
1. コスト管理の強化。必要に応じて動的に処理能力を増減でき、稼働した EC2 インスタンスのみの料金を支払うため、必要なときにインスタンスを起動し、不要な場合は削除することで費用を節約することができます。

## 注意事項
1. Auto Scalingはアクセス増加検知後にAMIからEC2を作成する特性から、急なアクセス増加（スパイク）に対応することができません。[急なアクセスに耐えうるサービス](https://d1.awsstatic.com/events/jp/2020/innovate/pdf/S-19_AWSInnovate_Online_Conference_2020_Spring_Spiky_Serverless_App.pdf)
1. 起動中のEC2に変更を行った場合、AMIにも変更を適用します。事前に指定したAMIで起動するため、適用しなければAuto Scalingで起動したEC2インスタンスは古い状態で起動されます。
1. セッション情報などのリクエストに関連する情報は、他インスタンスでも利用する可能性があるため、EBSなどのインスタンスに依存しているディスクに保存するのではなく、DynamoDBなどの他のサービスを活用します。